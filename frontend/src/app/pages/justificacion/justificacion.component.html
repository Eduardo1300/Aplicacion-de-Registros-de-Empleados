<div class="justificacion-container">
  <!-- Header -->
  <div class="justificacion-header">
    <h2 class="page-title">
      <i class="fas fa-file-invoice me-2"></i>Centro de Justificaciones
    </h2>
    <p class="page-subtitle">Justifica tus tardanzas o faltas de asistencia</p>
  </div>

  <!-- Mensajes de estado -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="fas fa-exclamation-circle me-2"></i>{{ error }}
    <button type="button" class="btn-close" (click)="error = ''"></button>
  </div>

  <div *ngIf="mensaje" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="fas fa-check-circle me-2"></i>{{ mensaje }}
    <button type="button" class="btn-close" (click)="mensaje = ''"></button>
  </div>

  <!-- Contenido principal -->
  <div class="justificacion-content">
    
    <!-- Sección de faltas sin justificar -->
    <div class="section-card">
      <div class="section-header">
        <h3>
          <i class="fas fa-clock text-warning"></i>
          Faltas Pendientes de Justificación
          <span class="badge bg-danger">{{ getFaltasSinJustificar().length }}</span>
        </h3>
      </div>

      <div *ngIf="getFaltasSinJustificar().length > 0; else noFaltasPendientes" class="faltas-grid">
        <div *ngFor="let falta of getFaltasSinJustificar()" class="falta-card pending">
          <div class="falta-header">
            <div class="falta-tipo" [ngClass]="getTipoBadgeClass(getTipoDeAsistencia(falta.estadoAsist))">
              <i [ngClass]="getTipoIcon(getTipoDeAsistencia(falta.estadoAsist))" class="me-2"></i>
              {{ getTipoDeAsistencia(falta.estadoAsist) | uppercase }}
            </div>
            <div class="falta-fecha">
              <i class="fas fa-calendar-alt me-1"></i>
              {{ falta.fecha | date:'dd/MM/yyyy' }}
            </div>
          </div>

          <div class="falta-body">
            <p class="falta-descripcion">
              <strong>Estado:</strong> {{ falta.estadoAsist }}
            </p>
          </div>

          <div class="falta-footer">
            <button class="btn btn-primary btn-sm" (click)="abrirFormulario(falta)">
              <i class="fas fa-pen me-2"></i>Justificar
            </button>
          </div>
        </div>
      </div>

      <ng-template #noFaltasPendientes>
        <div class="empty-state">
          <i class="fas fa-check-circle"></i>
          <p>¡Felicidades! No tienes ninguna falta pendiente de justificación.</p>
        </div>
      </ng-template>
    </div>

    <!-- Sección de faltas justificadas -->
    <div class="section-card" *ngIf="getFaltasJustificadas().length > 0">
      <div class="section-header">
        <h3>
          <i class="fas fa-history text-info"></i>
          Historial de Justificaciones
          <span class="badge bg-info">{{ getFaltasJustificadas().length }}</span>
        </h3>
      </div>

      <div class="faltas-grid">
        <div *ngFor="let justificacion of getFaltasJustificadas()" class="falta-card justified">
          <div class="falta-header">
            <div class="falta-tipo" [ngClass]="getTipoBadgeClass(getTipoDeAsistencia(justificacion.asistencia?.estadoAsist))">
              <i [ngClass]="getTipoIcon(getTipoDeAsistencia(justificacion.asistencia?.estadoAsist))" class="me-2"></i>
              {{ getTipoDeAsistencia(justificacion.asistencia?.estadoAsist) | uppercase }}
            </div>
            <div class="falta-estado" [ngClass]="getEstadoBadgeClass(justificacion.estado)">
              <i class="fas fa-check me-1" *ngIf="justificacion.estado && justificacion.estado.toUpperCase() !== 'PENDIENTE'"></i>
              <span *ngIf="!justificacion.estado || justificacion.estado.toUpperCase() === 'PENDIENTE'">En espera</span>
              <span *ngIf="justificacion.estado && justificacion.estado.toUpperCase() !== 'PENDIENTE'">{{ justificacion.estado | uppercase }}</span>
            </div>
          </div>

          <div class="falta-body">
            <p class="falta-descripcion">
              <strong>Motivo:</strong> {{ justificacion.descripcion || 'Sin descripción' }}
            </p>
            <div class="falta-fecha">
              <i class="fas fa-calendar-alt me-1"></i>
              {{ justificacion.asistencia?.fecha | date:'dd/MM/yyyy' }}
            </div>
            <div *ngIf="justificacion.comentario">
              <strong>Comentario del admin:</strong> {{ justificacion.comentario }}
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Modal de Justificación -->
  <div *ngIf="mostrarFormulario" class="modal-overlay" (click)="cerrarFormulario()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h4 class="modal-title">
          <i class="fas fa-file-alt me-2"></i>Justificar {{ getTipoDeAsistencia(faltaSeleccionada?.estadoAsist) | uppercase }}
        </h4>
        <button type="button" class="btn-close" (click)="cerrarFormulario()"></button>
      </div>

      <div class="modal-body">
        <div *ngIf="faltaSeleccionada" class="falta-info">
          <div class="info-row">
            <span class="info-label">Tipo:</span>
            <span class="info-value">
              <span [ngClass]="getTipoBadgeClass(getTipoDeAsistencia(faltaSeleccionada.estadoAsist))" class="badge">
                {{ getTipoDeAsistencia(faltaSeleccionada.estadoAsist) | uppercase }}
              </span>
            </span>
          </div>
          <div class="info-row">
            <span class="info-label">Fecha:</span>
            <span class="info-value">{{ faltaSeleccionada.fecha | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>

        <form (ngSubmit)="enviarJustificacion()" #justForm="ngForm">
          <div class="form-group">
            <label for="descripcion" class="form-label">
              <i class="fas fa-comment me-2 text-primary"></i>Descripción de la justificación *
            </label>
            <textarea 
              id="descripcion" 
              class="form-control"
              [(ngModel)]="justificacion.descripcion"
              name="descripcion"
              rows="4"
              placeholder="Explica brevemente el motivo de tu tardanza o falta..."
              required>
            </textarea>
            <small class="form-text text-muted">Mínimo 10 caracteres</small>
          </div>

          <div class="form-group">
            <label for="documentoUrl" class="form-label">
              <i class="fas fa-link me-2 text-success"></i>Enlace a documento (Opcional)
            </label>
            <input 
              id="documentoUrl"
              type="url"
              class="form-control"
              [(ngModel)]="justificacion.documentoUrl"
              name="documentoUrl"
              placeholder="https://ejemplo.com/documento..."
            />
            <small class="form-text text-muted">Puedes adjuntar un enlace a un comprobante (certificado médico, etc.)</small>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="cerrarFormulario()">
              <i class="fas fa-times me-2"></i>Cancelar
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="!justForm.valid">
              <i class="fas fa-paper-plane me-2"></i>Enviar Justificación
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

</div>
